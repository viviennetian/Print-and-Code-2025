<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Mart: Unseen Costs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* --- 1. 全局设置 --- */
        body {
            margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #FFFFFF; height: 100vh; overflow: hidden; position: relative;
        }

        /* --- 2. 海报层 (底层) --- */
        #poster-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #e0e0e0; background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px; z-index: 1; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }
        .center-title {
            font-family: 'Gotham'; font-weight: 900; font-size: 80px;
            color: #111; text-transform: uppercase; z-index: 1000; text-align: center;
            pointer-events: none;
        }
        /* 海报里散落的小票样式 */
        .scattered-receipt {
            position: absolute; width: 200px; background: #fff; padding: 15px;
            font-family: 'Courier New', monospace; font-size: 10px; color: #000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 10; transition: transform 0.3s;
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 95% 99%, 90% 100%, 85% 99%, 80% 100%, 75% 99%, 70% 100%, 65% 99%, 60% 100%, 55% 99%, 50% 100%, 45% 99%, 40% 100%, 35% 99%, 30% 100%, 25% 99%, 20% 100%, 15% 99%, 10% 100%, 5% 98%, 0% 100%);
        }
        .scattered-receipt:hover { z-index: 999; transform: scale(1.1) !important; }
       /* 同时修改一下 .poster-controls 让按钮竖着排比较好看 */
    .poster-controls { 
        position: absolute; bottom: 30px; right: 30px; z-index: 2000; 
        display: flex; 
       flex-direction: column; /* 让按钮竖向排列 */
       align-items: flex-end;
    }
        .btn-back {
            padding: 15px 30px; background: #111; color: #fff; border: none;
            font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        }
        .btn-back:hover { background: #333; }
        /* 新增这个样式 */
.btn-export {
    padding: 15px 30px; 
    border: 2px solid #000;
    font-size: 14px; 
    font-weight: bold; 
    cursor: pointer; 
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    font-family: 'Courier New', monospace; 
    text-transform: uppercase;
    background: #fff; 
    color: #000;
    margin-bottom: 10px; /* 让它和返回按钮有点间距 */
    display: block; /* 确保它独占一行或排列整齐 */
}
.btn-export:hover { 
    background: #000; 
    color: #fff; 
}

        /* --- 3. 购物层 (顶层) --- */
        #shop-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #FFFFFF; z-index: 5000; display: flex;
            transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }
        body.show-poster #shop-layer { transform: translateY(-100%); }

       /* 修改 .market-area */
.market-area {
    flex: 1; padding: 40px; overflow-y: auto;
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px; 
    align-content: start;
    background: #000000; /* 深色背景，像机器内部 */
}

/* 修改 .product-card：变成一个格子 */
.product-card {
    border: 2px solid #d3d3d3; /* 格子的边框 */
    background: #ffffff;
    padding: 20px;
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
}

/* 加一个贩卖机编号标签 */
.product-card::after {
    content: 'ITEM'; /* 这里可以用CSS计数器自动生成编号，或者写死 */
    position: absolute;
    bottom: 5px; right: 5px;
    background: #000;
    color: #0f0; /* 电子绿 */
    font-family: 'Courier New', monospace;
    font-size: 10px;
    padding: 2px 5px;
}

.product-card:hover {
    border-color: #faff98; /* 悬停时格子亮起 */
    box-shadow: 0 0 15px rgba(255, 206, 206, 0.2);
}

        .product-card img { width: 100%; height: auto; display: block; }


        /* --- Wallet 样式重构 (小票风格) --- */
        .fab-add {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #000; color: #fff; border: none; padding: 12px 25px;
            border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 100;
        }

        /* 核心改动：将 wallet-area 变成一张长小票 */
        .wallet-area {
            width: 340px;
            background: #f0f0f0; /* 纯白纸张背景 */
            /* 移除原来的边框和阴影 */
            border-left: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); /* 给整张纸加一个轻微的浮起阴影 */
            display: flex; flex-direction: column; position: relative;
            /* 统一使用小票字体 */
            font-family: 'Courier New', Courier, monospace;
            color: #000;
            margin: 20px; /* 与边缘留点空隙 */
            height: calc(100% - 40px); /* 高度占满 */
            /* 添加顶部和底部的锯齿效果 */
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 95% 99%, 90% 100%, 85% 99%, 80% 100%, 75% 99%, 70% 100%, 65% 99%, 60% 100%, 55% 99%, 50% 100%, 45% 99%, 40% 100%, 35% 99%, 30% 100%, 25% 99%, 20% 100%, 15% 99%, 10% 100%, 5% 98%, 0% 100%);
        }
        
        .wallet-header {
            padding: 20px; background: transparent; /* 透明背景 */
            border-bottom: 2px dashed #000; /* 虚线分割 */
            text-align: center;
        }
        .balance-amount { font-size: 36px; font-weight: bold; margin-top: 5px; color: #000; }
        
        .transaction-list {
            flex: 1; padding: 10px 20px; overflow-y: auto;
            /* 隐藏滚动条但保持可滚动 (兼容性写法) */
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .transaction-list::-webkit-scrollbar { display: none; }

        /* 列表项的小票化改造 */
        .tx-item {
            display: flex; justify-content: space-between; align-items: baseline;
            margin-bottom: 8px; padding-bottom: 8px;
            border-bottom: 1px dotted #000; /* 点状分割线 */
            font-size: 12px; animation: slideIn 0.3s ease;
        }
        .tx-info { flex: 1; }
        .tx-name { font-weight: bold; }
        .tx-meta { font-size: 10px; display: block; margin-top: 2px;}
        /* 价格不再分红绿，统一黑色 */
        .tx-price { font-weight: bold; margin: 0 10px; color: #000; }
        
        .btn-delete { color: #000; cursor: pointer; font-size: 14px; padding: 0 5px; font-weight: bold;}
        .btn-delete:hover { color: #ff3333; /* 只有鼠标放上去才显示红色叉号 */ }

        .wallet-footer {
            padding: 20px; background: transparent;
            border-top: 2px dashed #000; /* 虚线分割 */
            text-align: center;
        }
        /* 结算按钮小票化 */
        .btn-checkout {
            width: 100%; padding: 12px; background: #fff; color: #000;
            border: 2px solid #000; /* 黑框按钮 */
            font-weight: bold; cursor: pointer; font-family: 'Courier New', monospace;
            text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s;
        }
        .btn-checkout:hover { background: #000; color: #fff; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="poster-layer">
        <div class="center-title">UNSEEN<br>COSTS</div>
        <div id="receipt-container"></div>
       <div class="poster-controls">
            <button class="btn-export" onclick="exportToPDF()">Export Poster (PDF)</button>
            <button class="btn-back" onclick="continueShopping()">+ Continue Life (Shop More)</button>
        </div>
    </div>

    <div id="shop-layer">
        <div class="market-area" id="shelf">
            <button class="fab-add" onclick="addRandomProduct()">+ Show Me More Items In the Market</button>
        </div>

        <div class="wallet-area">
            <div class="wallet-header">
                <div style="font-size: 12px; font-weight: bold;">CARE MART</div>
                <div style="font-size: 10px; margin-bottom: 10px;">Store #0821 - Live Balance</div>
                <div class="balance-amount" id="balance">50.00</div>
                <div style="font-size: 10px;">AU (Affective Units)</div>
            </div>
            <div class="transaction-list" id="cart-list">
                <div id="empty-msg" style="text-align:center; color:#000; margin-top:50px; font-size:12px; font-weight:bold;">
                    [ RECEIPT EMPTY ]<br>...WAITING FOR INPUT...
                </div>
            </div>
            <div class="wallet-footer">
                <button class="btn-checkout" onclick="checkoutAndGenerate()">PRINT & POST</button>
            </div>
        </div>
    </div>

    <script>
        // === 数据配置 ===
    const inventory = [
  {
    imageSrc: "SMARTPHONEPROMAX.png",
    name: "Smartphone Pro Max",
    price: -240.0,
    type: "debit",
    stickerText: "HIGH DRAIN DEVICE"
  },
  {
    imageSrc: "LAPTOPCHARGER.png",
    name: "Laptop Charger",
    price: -28.0,
    type: "debit",
    stickerText: "ENERGY EXTRACTION FEE"
  },
  {
    imageSrc: "PORTABLEPOWERBANK.png",
    name: "Portable Power Bank",
    price: -18.0,
    type: "debit",
    stickerText: "OVERTIME SURCHARGE"
  },
  {
    imageSrc: "MECHANICALKEYBOARD.png",
    name: "Mechanical Keyboard",
    price: -32.0,
    type: "debit",
    stickerText: "WORKLOAD AMPLIFIER"
  },
  {
    imageSrc: "NOISECANCELLINGEARBUDS.png",
    name: "Noise-Cancelling Earbuds",
    price: -85.0,
    type: "debit",
    stickerText: "ISOLATION COST APPLIED"
  },
  {
    imageSrc: "PAINRELIEFTABLETS.png",
    name: "Pain Relief Tablets",
    price: -14.5,
    type: "debit",
    stickerText: "TEMPORARY FUNCTION RESTORE"
  },
  {
    imageSrc: "ENERGYDRINK.png",
    name: "Energy Drink",
    price: -5.2,
    type: "debit",
    stickerText: "SHORT-TERM BOOST PENALTY"
  },
  {
    imageSrc: "ESPRESSOSHOT.png",
    name: "Espresso Shot",
    price: -4.6,
    type: "debit",
    stickerText: "ADRENALINE TAX"
  },
  {
    imageSrc: "COLDBREWBOTTLE.png",
    name: "Cold Brew Bottle",
    price: -5.4,
    type: "debit",
    stickerText: "STIMULATION FEE"
  },
  {
    imageSrc: "SPICYCHIPSBAG.png",
    name: "Spicy Chips Bag",
    price: -3.9,
    type: "debit",
    stickerText: "DIGESTIVE DISTURBANCE"
  },
  {
    imageSrc: "INSTANTNOODLES.png",
    name: "Instant Noodles",
    price: -3.4,
    type: "debit",
    stickerText: "LOW VALUE INPUT"
  },
  {
    imageSrc: "FRIEDCHICKENBOX.png",
    name: "Fried Chicken Box",
    price: -11.8,
    type: "debit",
    stickerText: "HEAVY PROCESSING COST"
  },
  {
    imageSrc: "FASTFOODCOMBOMEAL.png",
    name: "Fast Food Combo Meal",
    price: -9.9,
    type: "debit",
    stickerText: "SATIATION SURCHARGE"
  },
  {
    imageSrc: "MIDNIGHTSNACKPACK.png",
    name: "Midnight Snack Pack",
    price: -5.1,
    type: "debit",
    stickerText: "CIRCADIAN DISRUPTION"
  },
  {
    imageSrc: "CHEAPCANDYBAG.png",
    name: "Cheap Candy Bag",
    price: -2.9,
    type: "debit",
    stickerText: "SUGAR SPIKE FEE"
  },
  {
    imageSrc: "HIGHHEELS.png",
    name: "High Heels",
    price: -25.0,
    type: "debit",
    stickerText: "POSTURE DAMAGE ALERT"
  },
  {
    imageSrc: "INDUSTRIALWORKGLOVES.png",
    name: "Industrial Work Gloves",
    price: -7.8,
    type: "debit",
    stickerText: "LABOR INTENSITY TAG"
  },
  {
    imageSrc: "EARPLUGSFOAM.png",
    name: "Earplugs (Foam)",
    price: -4.2,
    type: "debit",
    stickerText: "SENSORY BLOCK CHARGE"
  },
  {
    imageSrc: "OTCSLEEPAID.png",
    name: "OTC Sleep Aid",
    price: -13.0,
    type: "debit",
    stickerText: "SYNTHETIC REST TOKEN"
  },
  {
    imageSrc: "SOFTBLANKET.png",
    name: "Soft Blanket",
    price: 22.0,
    type: "credit",
    stickerText: "RESTORATION UNIT"
  },
  {
    imageSrc: "WARMSOCKS.png",
    name: "Warm Socks",
    price: 7.2,
    type: "credit",
    stickerText: "THERMAL COMFORT BOOST"
  },
  {
    imageSrc: "HEATPATCH.png",
    name: "Heat Patch",
    price: 5.8,
    type: "credit",
    stickerText: "TENSION RELEASE MODULE"
  },
  {
    imageSrc: "WEIGHTEDSLEEPMASK.png",
    name: "Weighted Sleep Mask",
    price: 14.0,
    type: "credit",
    stickerText: "SLEEP STABILIZATION FIELD"
  },
  {
    imageSrc: "AROMATHERAPYCANDLE.png",
    name: "Aromatherapy Candle",
    price: 9.5,
    type: "credit",
    stickerText: "MOOD REALIGNMENT"
  },
  {
    imageSrc: "EUCALYPTUSSHOWERTABLETS.png",
    name: "Eucalyptus Shower Tablets",
    price: 6.6,
    type: "credit",
    stickerText: "RESPIRATION ENHANCER"
  },
  {
    imageSrc: "HERBALTEABOX.png",
    name: "Herbal Tea Box",
    price: 6.0,
    type: "credit",
    stickerText: "CALMING INPUT"
  },
  {
    imageSrc: "VITAMINGUMMIES.png",
    name: "Vitamin Gummies",
    price: 7.4,
    type: "credit",
    stickerText: "BODY MAINTENANCE CREDIT"
  },
  {
    imageSrc: "FRESHFLOWERSBOUQUET.png",
    name: "Fresh Flowers Bouquet",
    price: 12.0,
    type: "credit",
    stickerText: "AESTHETIC RECOVERY"
  },
  {
    imageSrc: "COZYSLIPPERS.png",
    name: "Cozy Slippers",
    price: 16.0,
    type: "credit",
    stickerText: "FOOT COMFORT PRIORITY"
  },
  {
    imageSrc: "PLUSHBUNNYTOY.png",
    name: "Plush Bunny Toy",
    price: 18.0,
    type: "credit",
    stickerText: "EMOTIONAL SUPPORT TOKEN"
  },
  {
    imageSrc: "YOGAMAT.png",
    name: "Yoga Mat",
    price: 28.0,
    type: "credit",
    stickerText: "REBALANCING MODULE"
  },
  {
    imageSrc: "SOOTHINGFACIALMIST.png",
    name: "Soothing Facial Mist",
    price: 8.5,
    type: "credit",
    stickerText: "REFRESHMENT PULSE"
  },
  {
    imageSrc: "ESSENTIALOILSROLLON.png",
    name: "Essential Oils Roll-On",
    price: 9.2,
    type: "credit",
    stickerText: "AROMA CALIBRATION"
  },
  {
    imageSrc: "ALCOHOLMINIBOTTLE.png",
    name: "Alcohol Mini Bottle",
    price: -7.0,
    type: "debit",
    stickerText: "TEMPORARY ESCAPE FEE"
  },
  {
    imageSrc: "SWEETPASTRYBOX.png",
    name: "Sweet Pastry Box",
    price: -6.2,
    type: "debit",
    stickerText: "PLEASURE TAX"
  },
  {
    imageSrc: "HEAVYTEXTBOOK.png",
    name: "Heavy Textbook",
    price: -15.0,
    type: "debit",
    stickerText: "MENTAL LOAD WARNING"
  },
  {
    imageSrc: "COMMUTERBACKPACK.png",
    name: "Commuter Backpack",
    price: -12.0,
    type: "debit",
    stickerText: "DAILY BURDEN TAG"
  },
  {
    imageSrc: "OVEREARHEADPHONES.png",
    name: "Over-Ear Headphones",
    price: -65.0,
    type: "debit",
    stickerText: "ISOLATED OVERLOAD"
  },
  {
    imageSrc: "HANDCREAMTUBE.png",
    name: "Hand Cream Tube",
    price: 6.3,
    type: "credit",
    stickerText: "SOFTNESS MODULE"
  },
  {
    imageSrc: "BATHSALTJAR.png",
    name: "Bath Salt Jar",
    price: 11.0,
    type: "credit",
    stickerText: "MUSCLE RECOVERY PROGRAM"
  },
  {
    imageSrc: "LAVENDERPILLOWSPRAY.png",
    name: "Lavender Pillow Spray",
    price: 9.1,
    type: "credit",
    stickerText: "SLEEP ENHANCEMENT FIELD"
  },
  {
    imageSrc: "FRESHBREADLOAF.png",
    name: "Fresh Bread Loaf",
    price: 4.9,
    type: "credit",
    stickerText: "WARMTH INPUT"
  }
];


        let currentBalance = 50.00;
        let currentCartItems = []; 
        const shelfEl = document.getElementById('shelf');
        const cartEl = document.getElementById('cart-list');
        const balanceEl = document.getElementById('balance');
        const receiptContainer = document.getElementById('receipt-container');

        function renderCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            // 纯图片结构
            card.innerHTML = `<img src="${product.imageSrc}" alt="${product.name}">`;
            card.onclick = () => addToCart(product);
            shelfEl.appendChild(card);
            card.querySelector('img').onload = () => { shelfEl.scrollTop = shelfEl.scrollHeight; };
        }

        function addRandomProduct() {
            const randomItem = inventory[Math.floor(Math.random() * inventory.length)];
            renderCard(randomItem);
        }

        function addToCart(product) {
            if(document.getElementById('empty-msg')) document.getElementById('empty-msg').remove();
            const item = document.createElement('div');
            item.className = 'tx-item';
            // 价格符号
            const priceSign = product.type === 'credit' ? '+' : '';
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            // 小票风格的列表项HTML
            item.innerHTML = `
                <div class="tx-info">
                    <div class="tx-name">${product.name}</div>
                    <span class="tx-meta">${time} . ${product.stickerText}</span>
                </div>
                <div class="tx-price">${priceSign}${product.price.toFixed(2)}</div>
                <div class="btn-delete">X</div>
            `;
            const itemData = { name: product.name, price: product.price, type: product.type };
            currentCartItems.push(itemData);
            
            item.querySelector('.btn-delete').onclick = function() {
                item.remove();
                updateBalance(-product.price);
                const index = currentCartItems.indexOf(itemData);
                if (index > -1) currentCartItems.splice(index, 1);
                if(cartEl.children.length === 0) {
                    cartEl.innerHTML = '<div id="empty-msg" style="text-align:center; color:#000; margin-top:50px; font-size:12px; font-weight:bold;">[ RECEIPT EMPTY ]<br>...WAITING FOR INPUT...</div>';
                }
            };
            cartEl.insertBefore(item, cartEl.firstChild);
            updateBalance(product.price);
        }

        // 更新余额 (颜色移除，统一黑色)
        function updateBalance(amount) {
            currentBalance += amount;
            balanceEl.innerText = currentBalance.toFixed(2);
            // balanceEl.style.color = currentBalance < 20 ? '#e74c3c' : '#333'; // 旧逻辑，移除
        }

        function checkoutAndGenerate() {
            if(currentCartItems.length === 0) { alert("Ticket empty!"); return; }
            createPosterReceipt(currentCartItems, currentBalance);
            currentCartItems = [];
            cartEl.innerHTML = '<div id="empty-msg" style="text-align:center; color:#000; margin-top:50px; font-size:12px; font-weight:bold;">[ RECEIPT EMPTY ]<br>...WAITING FOR INPUT...</div>';
            document.body.classList.add('show-poster');
        }

function createPosterReceipt(items, finalBalance) {
    const receipt = document.createElement('div');
    receipt.className = 'scattered-receipt';
    
    let itemsHtml = '';
    let totalLoad = 0;
    
    // 生成商品列表
    items.forEach(item => {
        itemsHtml += `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px dotted #000;">
                <span>${item.name}</span>
                <span>${item.price.toFixed(2)}</span>
            </div>`;
        totalLoad += item.price;
    });

    const randomId = Math.floor(Math.random() * 9000) + 1000;

    // --- 在这里加入了你要求的声明 ---
    receipt.innerHTML = `
        <div style="text-align:center; border-bottom:2px dashed #000; padding-bottom:5px; margin-bottom:10px;">
            <strong>CARE MART</strong><br>No. ${randomId}
        </div>
        
        <div style="margin-bottom:10px;">${itemsHtml}</div>
        
        <div style="text-align:right; font-weight:bold; border-top:2px dashed #000; padding-top:5px;">
            TOTAL LOAD: ${totalLoad.toFixed(2)} AU <br>
            BALANCE: ${finalBalance.toFixed(2)} AU
        </div>
        
        <div style="text-align:center; font-size:8px; margin-top:15px; color:#000; line-height: 1.5; font-weight: bold;">
            *** DISCLAIMER ***<br>
            ANY PHYSICAL BURDENS PURCHASED<br>
            TODAY ARE NON-REFUNDABLE.<br>
            <br>
            EMOTIONAL FLUCTUATIONS WILL<br>
            AUTOMATICALLY SETTLE WITHIN 24 HOURS.<br>
            <br>
            
        </div>
    `;
            // 随机位置
            const randomTop = Math.random() * 60 + 20; 
            const randomLeft = Math.random() * 60 + 20;
            
            receipt.style.top = randomTop + '%';
            receipt.style.left = randomLeft + '%';
            receipt.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 60 - 30}deg)`;
            receiptContainer.appendChild(receipt);
        }

        function continueShopping() { document.body.classList.remove('show-poster'); }

        window.onload = function() { addRandomProduct(); addRandomProduct(); };

        // === 新增：导出 PDF 的核心功能 ===
// === 最终版：导出竖向 PDF (7.5 x 10.5) ===
window.exportToPDF = async function() {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById('poster-layer');
    
    // 1. 设定目标尺寸：竖向 (宽 7.5 x 高 10.5)
    // 之前是 10.5 x 7.5，现在我们把数字互换
    const targetWidthInches = 7.5;
    const targetHeightInches = 10.5;
    
    // 2. 临时锁定海报层尺寸 (关键步骤：防止变形)
    const originalWidth = element.style.width;
    const originalHeight = element.style.height;
    const originalPos = element.style.position;
    
    // 强制把网页元素变成竖向比例 (1125px x 1575px)
    // 这样截图出来的形状就天然是竖着的，放进PDF就不会被挤压
    element.style.width = "1125px";  
    element.style.height = "1575px"; 
    
    try {
        const canvas = await html2canvas(element, {
            scale: 2, // 保持高清
            useCORS: true,
            backgroundColor: '#F0F0F0',
            // 强制截图区域也设为竖向
            width: 1125,
            height: 1575,
            windowWidth: 1125,
            windowHeight: 1575,
            ignoreElements: (node) => {
                return node.classList.contains('center-title') || 
                       node.classList.contains('poster-controls');
            }
        });

        const imgData = canvas.toDataURL('image/jpeg', 0.95);
        
        // 3. 生成 PDF
        // orientation: 'p' 代表 Portrait (竖向)
        const pdf = new jsPDF({
            orientation: 'p', 
            unit: 'in',
            format: [targetWidthInches, targetHeightInches]
        });

        // 4. 填入图片
        pdf.addImage(imgData, 'JPEG', 0, 0, targetWidthInches, targetHeightInches);
        pdf.save('CareMart_Poster_Portrait.pdf');
        
    } catch (err) {
        console.error("Export failed:", err);
        alert("导出出错，请重试");
    } finally {
        // 5. 恢复原来的样式
        element.style.width = originalWidth;
        element.style.height = originalHeight;
        element.style.position = originalPos;
    }
}
    </script>
</body>
</html>